<div class="min-h-screen w-full flex items-center justify-center p-4 relative z-10 pt-20">

  <div #formCard class="w-full max-w-4xl glass-panel p-10 rounded-2xl relative overflow-hidden">
    <!-- Background Glow -->
    <div class="absolute top-0 right-0 w-64 h-64 bg-[#d1f83b]/5 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 pointer-events-none"></div>

    <div class="flex items-center gap-4 mb-8">
      <div class="w-12 h-12 rounded-full bg-[#d1f83b]/10 flex items-center justify-center text-[#d1f83b]">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path></svg>
      </div>
      <div>
        <h1 class="text-3xl font-bold text-white">Create Order</h1>
        <p class="text-gray-400 text-sm">Select a supplier and add products to the order.</p>
      </div>
    </div>

    <form (ngSubmit)="submit()" class="space-y-8 relative z-10">

      <div class="group">
        <label class="label-text">Supplier</label>
        <div class="relative">
          <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-500">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path></svg>
          </div>
          <select [(ngModel)]="order.supplier" name="supplier" required class="input-field rounded-lg text-[#d1f83b] bg-[#09090b] appearance-none cursor-pointer pl-10">
            <option value="" disabled selected>Select a supplier...</option>
            <option *ngFor="let s of suppliers" [ngValue]="s.id">{{ s.company }}</option>
          </select>
          <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-gray-500">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
          </div>
        </div>
      </div>

      <div class="glass-panel p-6 rounded-xl bg-black/20">
        <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
          <span class="w-2 h-2 rounded-full bg-[#d1f83b]"></span>
          Select Products
        </h3>

        <div class="grid grid-cols-1 gap-3 max-h-[400px] overflow-y-auto pr-2 custom-scrollbar">
          <div *ngFor="let p of products"
               class="flex items-center gap-4 p-4 rounded-lg border border-white/5 transition-all duration-300 cursor-pointer"
               [class.bg-[#d1f83b]/10]="isSelected(p)"
               [class.border-[#d1f83b]/30]="isSelected(p)"
               [class.bg-white/5]="!isSelected(p)"
               (click)="toggleProductSelection(p)">

            <!-- Checkbox -->
            <div class="w-5 h-5 rounded border flex items-center justify-center transition-colors"
                 [class.border-[#d1f83b]]="isSelected(p)"
                 [class.bg-[#d1f83b]]="isSelected(p)"
                 [class.border-gray-600]="!isSelected(p)">
              <svg *ngIf="isSelected(p)" class="w-3 h-3 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
            </div>

            <!-- Product Info -->
            <div class="grow">
              <div class="text-white font-medium">{{ p.name }}</div>
              <div class="text-xs text-gray-500">Stock: {{ p.quantity }} | ${{ p.unitPrice }}</div>
            </div>

            <!-- Quantity Input -->
            <div *ngIf="isSelected(p)" class="flex items-center gap-2" (click)="$event.stopPropagation()">
              <label class="text-xs text-gray-400 uppercase font-bold">Qty</label>
              <input
                type="number"
                [ngModel]="getProductQuantity(p)"
                (ngModelChange)="setProductQuantity(p, $event)"
                name="quantity-{{p.id}}"
                min="1"
                class="w-20 bg-black/30 border border-white/10 rounded px-2 py-1 text-white text-right focus:border-[#d1f83b] focus:outline-none"
              >
            </div>

          </div>
        </div>
      </div>

      <!-- Order Summary -->
      <div class="flex justify-between items-center p-4 border-t border-white/10">
        <div class="text-sm text-gray-400">
          Total Items: <span class="text-white font-bold">{{ getTotalItems() }}</span>
        </div>
        <div class="text-xl font-bold text-white">
          Total: <span class="text-[#d1f83b]">${{ getTotalCost() | number:'1.2-2' }}</span>
        </div>
      </div>

      <div class="flex gap-4 pt-4">
        <button type="button" (click)="cancel()" class="btn-secondary w-full rounded-lg">Cancel</button>
        <button type="submit" class="btn-primary w-full rounded-lg" [disabled]="!order.supplier || order.products.length === 0">
          Create Order
        </button>
      </div>

    </form>
  </div>
</div>
